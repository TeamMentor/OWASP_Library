<?xml version="1.0" encoding="utf-8"?>
<guidanceItem id="31a7325f-96da-4736-aeca-95556d9f3efe" Author="" Category="Authorization" Priority="2" Rule_Type="Checklist Item" Status="" Technology="Java" title="Role-based Security Checks are Performed" Topic="Security" phase="Design" xmlns="urn:microsoft:guidanceexplorer:guidanceItem">
  <content>&lt;h1&gt;What to Check For&lt;/h1&gt;&lt;p&gt;Ensure that all users are assigned to specific roles. Verify that all access controls are performed on a per-role basis rather than a per-user basis.&lt;/p&gt;&lt;h1&gt;Why&lt;/h1&gt;&lt;p&gt;Application roles allow multiple users to play the same role. This mechanism provides an easy and clear way to discover and manage the least privileges necessary for the execution of a given task. It provides a more robust and flexible way of managing the application's users.&lt;/p&gt;&lt;h1&gt;How to Check&lt;/h1&gt;&lt;p&gt;Use the following steps to determine if your application uses role-based access controls:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Check if your application uses user roles. &lt;/strong&gt;Verify that your application has established user roles and grants the appropriate access privileges to each user role. Example:&lt;/p&gt;&lt;pre&gt;Roles      Actions    Access Controls    Client Accounts&lt;br&gt;--------------------------------------------------------&lt;br&gt;Manager    Connect        Always            Always&lt;br&gt;           Read           Always            Always&lt;br&gt;           Use            Always            Occasionally&lt;br&gt;           Modify         Never             Occasionally&lt;br&gt;Employee   Connect        Always            Always&lt;br&gt;           Read           Always            Always&lt;br&gt;           Use            Always            Always&lt;br&gt;           Modify         Never             Never&lt;/pre&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Ensure your application enforces role-based security. &lt;/strong&gt;Verify that your application maps its access controls to the established user roles. Depending on your application's design, there are several ways of checking whether your application enforces role-based security:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Check for programmatical role-based security:&lt;/strong&gt; If your application uses programmatic security, verify that JAAS is implemented correctly throughout the code. Use the following steps to ensure that access controls are positioned according to your application's security requirements:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Identify all functionality that requires access controls:&lt;/strong&gt; Using your application's design, identify all functionality that requires special privileges. Verify that each protected functionality has a permissions check associated with it. For instance, the following code verifies that the user has permission to connect to the application:&lt;/p&gt;&lt;blockquote&gt;&lt;pre&gt;// The variable subject represents the user's identity an all&lt;br&gt;// security tokens that are associated with it&lt;br&gt;PrivilegedExceptionAction action = new AuthException("AccessApp");&lt;br&gt;Subject.doAsPrivileged(subject, action, null);&lt;/pre&gt;&lt;/blockquote&gt;&lt;p&gt;Note that &lt;strong&gt;AuthException&lt;/strong&gt; is a custom implementation of the &lt;strong&gt;PrivilegedExceptionAction&lt;/strong&gt; interface. See the &lt;a href="ruledisplay:6CD5BCAD-590C-4DB0-AC31-9D1F4A9201C9"&gt;Consider Using JAAS for Authorization&lt;/a&gt; guideline for more details.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Verify that all user roles' permissions comply with your application's security requirements:&lt;/strong&gt; Examine your application's JAAS policy and verify that each user role is granted only the necessary set of permissions. Example:&lt;/p&gt;&lt;blockquote&gt;&lt;pre&gt;grant Principal application.auth.GroupToken "users"&lt;br&gt;{&lt;br&gt;   permission java.security.SecurityPermission "AccessApp";&lt;br&gt;};&lt;/pre&gt;&lt;/blockquote&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Check for declarative role-based security:&lt;/strong&gt; If your application uses declarative security, examine its deployment descriptor file (e.g. &lt;strong&gt;web.xml&lt;/strong&gt;). Verify that access to protected resources is granted according to the application's security requirements.&amp;nbsp;Verify that each &lt;strong&gt;web-resource-collection&lt;/strong&gt; element inside the deployment descriptor is associated with the appropriate resource and user roles:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;security-constraint&lt;/strong&gt;: Check if all of your application's protected resources are placed within a &lt;strong&gt;security-constraint&lt;/strong&gt; element. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;web-resource-collection&lt;/strong&gt;: Check if all resources that share mutual access controls are encapsulated by the same &lt;strong&gt;web-resource-collection&lt;/strong&gt; element. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;web-resource-name&lt;/strong&gt;: Check if all collections of resources are identified by a name. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;url-pattern&lt;/strong&gt;: For each collection of resources, verify that all resources are placed in the appropriate &lt;strong&gt;web-resource-collection&lt;/strong&gt; elements. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;http-method&lt;/strong&gt;: If your application requires access controls only for specific HTTP methods, verify that all of these methods are identified appropriately. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;auth-constraint&lt;/strong&gt;: Check if each &lt;strong&gt;web-resource-collection&lt;/strong&gt; element has an &lt;strong&gt;auth-constraint&lt;/strong&gt; element associated with it. &lt;/li&gt;&lt;li&gt;&lt;strong&gt;role-name&lt;/strong&gt;: Verify that all roles are granted access according to your application's security requirements. &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Verify that users are assigned into their appropriate roles. &lt;/strong&gt;List all of your application's users. Check if each user is assigned into their appropriate role.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h1&gt;Problem Example&lt;/h1&gt;&lt;p&gt;The following segment illustrates a JAAS policy. Because the application does not enforce role-based security, it has a policy entry for each separate user; therefore, changing the users' access rights can be quite difficult as every user needs to be modified.&lt;/p&gt;&lt;br&gt;&lt;blockquote&gt;&lt;pre&gt;grant Principal application.auth.UserToken "joe"&lt;br&gt;{&lt;br&gt;   permission java.security.SecurityPermission "AccessApp";&lt;br&gt;};&lt;br&gt;grant Principal application.auth.UserToken "steve"&lt;br&gt;{&lt;br&gt;   permission java.security.SecurityPermission "AccessApp";&lt;br&gt;};&lt;br&gt;grant Principal application.auth.UserToken "julie"&lt;br&gt;{&lt;br&gt;   permission java.security.SecurityPermission "AccessApp";&lt;br&gt;};&lt;/pre&gt;&lt;/blockquote&gt;&lt;h1&gt;Related Guideline&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="ruledisplay:2A2791FA-47DB-4528-9EEC-03482142AABF"&gt;Guideline: Perform Role-Based Security Checks (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;</content>
</guidanceItem>