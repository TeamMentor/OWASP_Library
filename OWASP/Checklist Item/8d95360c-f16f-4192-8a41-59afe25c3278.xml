<?xml version="1.0" encoding="utf-8"?>
<guidanceItem id="8d95360c-f16f-4192-8a41-59afe25c3278" Author="" Category="Session Management" Priority="2" Rule_Type="Checklist Item" Status="" Technology="Java" title="JSESSIONIDs are Stored in the URL When Cookies are Disabled" Topic="Security" phase="Design" xmlns="urn:microsoft:guidanceexplorer:guidanceItem">
  <content>&lt;h1&gt;What to Check For&lt;/h1&gt;&lt;p&gt;Verify that &lt;strong&gt;JSESSIONID&lt;/strong&gt;s are stored inside the URL when cookies are disabled by the browser.&lt;/p&gt;&lt;h1&gt;Why&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;JSESSIONID&lt;/strong&gt;s are the identifiers that match a client to a session. The use of truly random &lt;strong&gt;JSESSIONID&lt;/strong&gt; makes it difficult for an attacker to hijack the session and impersonate a user.&lt;/p&gt;&lt;h1&gt;How to Check&lt;/h1&gt;&lt;p&gt;Session management encompasses the techniques employed by web applications to transparently authorize a user for every HTTP request without requiring the user to repeatedly login. J2EE session management uses a session-specific session identifier, &lt;strong&gt;JSESSIONID&lt;/strong&gt;, which is created at the start of each session. If your application needs to keep track of user sessions, use the following steps to ensure that your application tracks sessions securely:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Ensure your application verifies the use of cookies. &lt;/strong&gt;Check if your application verifies whether users' browsers have cookies enabled. If cookies are enabled, verify that sessions are handled via the use of cookies.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Ensure your application can use sessions if cookies are disabled. &lt;/strong&gt;If cookies are disabled, verify if your application uses &lt;strong&gt;HttpServletResponse.encodeURL&lt;/strong&gt; to store the &lt;strong&gt;JSESSIONIDs&lt;/strong&gt; in the URL. Example:&lt;/p&gt;&lt;blockquote&gt;&lt;pre&gt;String url = request.getRequestURL().toString();&lt;br&gt;&lt;strong&gt;       url = response.encodeURL(url);&lt;br&gt;&lt;/strong&gt;             response.sendRedirect(url);&lt;/pre&gt;&lt;/blockquote&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Ensure that JSESSIONIDs are stripped out from the&amp;nbsp;URL upon visiting external links. &lt;/strong&gt;Verify that your application sanitizes its URL when visiting external sites. Ensure that all &lt;strong&gt;JSESSIONID&lt;/strong&gt;s are removed when exiting your application.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h1&gt;Problem Example&lt;/h1&gt;&lt;p&gt;The following code shows the login interaction between the application and the user. Once the user requests the initial page, the application forwards them to the login screen. Upon verifying the credentials, the application loads the main application interface. Unfortunately, the application does not check whether the client supports cookies; therefore causing a broken access control as the valid user may not be able to access the application.&lt;/p&gt;&lt;br&gt;&lt;blockquote&gt;&lt;pre&gt;&amp;lt;%-- Filename: /myapp/index.jsp --%&amp;gt;&lt;br&gt;&amp;lt;%-- The application fails to check whether the client supports cookies --%&amp;gt;&lt;br&gt;&amp;lt;jsp:forward page="/myapp/login.jsp" /&amp;gt;  &lt;br&gt;&amp;lt;%-- Filename: /myapp/login.jsp --%&amp;gt;&lt;br&gt;&amp;lt;html&amp;gt;&lt;br&gt;  &amp;lt;head&amp;gt;&lt;br&gt;    &amp;lt;title&amp;gt;::login&amp;lt;/title&amp;gt;&lt;br&gt;  &amp;lt;/head&amp;gt;&lt;br&gt;  &amp;lt;body&amp;gt;&lt;br&gt;    &amp;lt;form method="POST" action="https://login.example.com/myapp/auth"&amp;gt;&lt;br&gt;    &amp;lt;input type="text" name="user" size="20"&amp;gt;&lt;br&gt;    &amp;lt;br&amp;gt;&amp;lt;input type="password" name="pass" size="20"&amp;gt;&lt;br&gt;    &amp;lt;br&amp;gt;&amp;lt;input type="submit" value="log in"&amp;gt;&lt;br&gt;    &amp;lt;/form&amp;gt;&lt;br&gt;  &amp;lt;/body&amp;gt;&lt;br&gt;&amp;lt;/html&amp;gt;&lt;br&gt;  /*  Filename: /myapp/auth  */import java.io.*;&lt;br&gt;                               import java.util.*;&lt;br&gt;                               import javax.servlet.*;&lt;br&gt;                               import javax.servlet.http.*;&lt;br&gt; public final class Auth extends HttpServlet&lt;br&gt;{&lt;br&gt;      public void doGet(HttpServletRequest request,&lt;br&gt;                        HttpServletResponse response)&lt;br&gt; throws ServletException,&lt;br&gt; IOException&lt;br&gt;      {&lt;br&gt;            HttpSession session = request.getSession(true);&lt;br&gt;            String redirectURL = "/myapp/main";&lt;br&gt;            //The application fails to check whether the client supports cookies&lt;br&gt;            ...&lt;br&gt;            response.sendRedirect(redirectURL);&lt;br&gt;      }&lt;br&gt;}&lt;/pre&gt;&lt;/blockquote&gt;&lt;h1&gt;Related Guideline&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="ruledisplay:169A99D8-459F-42D7-8E3D-F6B07D691733"&gt;Guideline: Store JSESSIONIDs in the URL When Cookies Are Disabled (Java Web Application)&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt;</content>
</guidanceItem>